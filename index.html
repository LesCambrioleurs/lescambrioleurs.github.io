<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tournées des Spectacles</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        #map {
            flex: 1;
            background: #f0f0f0;
        }
        .popup-content {
            font-size: 14px;
        }
        .popup-content strong {
            display: block;
            margin-bottom: 5px;
        }
        .legend {
            background-color: white;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            position: absolute;
            bottom: 10px;
            left: 10px;
            z-index: 1000;
        }
        .legend div {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        .legend span {
            width: 20px;
            height: 20px;
            display: inline-block;
            border-radius: 50%;
            margin-right: 10px;
        }

        /* TITRE */
        .header {
            background: white;
            padding: 15px 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        
        .header h1 {
            margin: 0;
            color: #333;
            font-size: 1.5em;
            text-align: center;
        }

        /* MODIFIER LE BODY POUR L'ADAPTER */
        body {
            height: 100vh;
            margin: 0;
        }

        /* Style du bouton */
        .reset-view-button {
            background: white !important;
            padding: 5px 10px !important;
            border-radius: 5px !important;
            border: 2px solid rgba(0,0,0,0.2) !important;
            cursor: pointer !important;
            font-weight: bold !important;
        }

        .reset-view-button:hover {
            background: #f8f9fa !important;
        }
        
        .stat-box {
            background-color: white;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            position: absolute;
            top: 80px;
            right: 10px;
            z-index: 1000;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Lieux de tournées des spectacles 2025</h1>
    </div>
    
    <div id="map"></div>

    <div class="legend">
        <div><span style="background-color: #00a933;"></span> Éducations Sentimentales</div>
        <div><span style="background-color: #9973e1;"></span> La Tendresse</div>
        <div><span style="background-color: #5b9bd5;"></span> Désobéir</div>
    </div>

    <div class="stat-box">
        <div><strong>Statistiques</strong></div>
        <div id="total-spectateurs">Total spectateurs: Chargement...</div>
        <div id="moyenne-frequentation">Fréquentation moyenne: Chargement...</div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  
    <script>
        const map = L.map('map', { zoomControl: true });
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        const tournees = [
         { spectacle: "La Tendresse", lieu: "DSN", ville: "Dieppe", pays: "France", region: "Normandie", dateDebut: "09/01/25", dateFin: "10/01/25", label: "Scène nationale", representations: 2, spectateurs: 717, jauge: 499, frequentation: 71.84, coords: [49.9213, 1.0775] },
            { spectacle: "La Tendresse", lieu: "La Comédie de Caen", ville: "Hérouville-Saint-Clair", pays: "France", region: "Normandie", dateDebut: "15/01/25", dateFin: "17/01/25", label: "Centre Dramatique National", representations: 3, spectateurs: 1964, jauge: 686, frequentation: 95.43, coords: [49.2039, -0.3261] },
            { spectacle: "La Tendresse", lieu: "Théâtre du Passage", ville: "Neuchâtel", pays: "Suisse", region: "International", dateDebut: "12/02/25", dateFin: "12/02/25", label: "non labellisé", representations: 1, spectateurs: 451, jauge: 524, frequentation: 86.07, coords: [46.9897, 6.9293] },
            { spectacle: "La Tendresse", lieu: "Théâtre André Malraux", ville: "Reuil-Malmaison", pays: "France", region: "Île-de-France", dateDebut: "04/03/25", dateFin: "04/03/25", label: "non labellisé", representations: 1, spectateurs: 709, jauge: 806, frequentation: 87.96, coords: [48.8769, 2.1872] },
            { spectacle: "La Tendresse", lieu: "Centre Culturel Jean Ferrat", ville: "Avion", pays: "France", region: "Hauts-de-France", dateDebut: "11/03/25", dateFin: "11/03/25", label: "non labellisé", representations: 1, spectateurs: 246, jauge: 340, frequentation: 72.35, coords: [50.4094, 2.8325] },
            { spectacle: "La Tendresse", lieu: "Palais des Beaux-Arts", ville: "Charleroi", pays: "Belgique", region: "International", dateDebut: "14/03/25", dateFin: "15/03/25", label: "non labellisé", representations: 2, spectateurs: 630, jauge: 330, frequentation: 95.45, coords: [50.4084, 4.4445] },
            { spectacle: "La Tendresse", lieu: "Le Tangram", ville: "Évreux", pays: "France", region: "Normandie", dateDebut: "20/03/25", dateFin: "20/03/25", label: "Scène nationale", representations: 1, spectateurs: 418, jauge: 500, frequentation: 83.60, coords: [49.0271, 1.1514] },
            { spectacle: "La Tendresse", lieu: "Espace Culturel Boris Vian", ville: "Les Ulis", pays: "France", region: "Île-de-France", dateDebut: "25/03/25", dateFin: "25/03/25", label: "non labellisé", representations: 1, spectateurs: 241, jauge: 400, frequentation: 60.25, coords: [48.6817, 2.1694] },
            { spectacle: "La Tendresse", lieu: "Centre Culturel de Sarlat", ville: "Sarlat", pays: "France", region: "Nouvelle-Aquitaine", dateDebut: "11/04/25", dateFin: "11/04/25", label: "non labellisé", representations: 1, spectateurs: 404, jauge: 544, frequentation: 74.26, coords: [44.8892, 1.2162] },
            { spectacle: "La Tendresse", lieu: "Le Moulin du Roc", ville: "Niort", pays: "France", region: "Nouvelle-Aquitaine", dateDebut: "15/04/25", dateFin: "15/04/25", label: "Scène nationale", representations: 1, spectateurs: 625, jauge: 670, frequentation: 93.28, coords: [46.3237, -0.4583] },
            { spectacle: "La Tendresse", lieu: "Le Gallia", ville: "Saintes", pays: "France", region: "Nouvelle-Aquitaine", dateDebut: "17/04/25", dateFin: "17/04/25", label: "Scène conventionnée", representations: 1, spectateurs: 474, jauge: 487, frequentation: 97.33, coords: [45.7479, -0.6349] },
            { spectacle: "La Tendresse", lieu: "ThéâtredelaCité", ville: "Toulouse", pays: "France", region: "Occitanie", dateDebut: "15/05/25", dateFin: "21/05/25", label: "Centre Dramatique National", representations: 6, spectateurs: 4840, jauge: 801, frequentation: 100.70, coords: [43.6045, 1.4440] },
            { spectacle: "La Tendresse", lieu: "Théâtre des Bouffes Parisiens", ville: "Paris", pays: "France", region: "Île-de-France", dateDebut: "25/04/25", dateFin: "12/07/25", label: "non labellisé", representations: 49, spectateurs: null, jauge: 550, frequentation: null, coords: [48.8566, 2.3522] },
            { spectacle: "Désobéir", lieu: "Centre Culturel Jacques Prévert", ville: "Villeparisis", pays: "France", region: "Île-de-France", dateDebut: "07/03/25", dateFin: "07/03/25", label: "non labellisé", representations: 1, spectateurs: null, jauge: null, frequentation: null, coords: [48.9431, 2.6056] },
            { spectacle: "Désobéir", lieu: "Théâtre de Gif-sur-Yvette", ville: "Gif-sur-Yvette", pays: "France", region: "Île-de-France", dateDebut: "22/03/25", dateFin: "22/03/25", label: "non labellisé", representations: 1, spectateurs: 325, jauge: 467, frequentation: 69.59, coords: [48.7010, 2.1340] },
            { spectacle: "Désobéir", lieu: "Théâtre La Criée", ville: "Marseille", pays: "France", region: "Provence-Alpes-Côte d'Azur", dateDebut: "24/04/25", dateFin: "27/04/25", label: "Centre Dramatique National", representations: 4, spectateurs: 2976, jauge: 771, frequentation: 96.49, coords: [43.2964, 5.3698] },
            { spectacle: "Désobéir", lieu: "Théâtre de La Concorde", ville: "Paris", pays: "France", region: "Île-de-France", dateDebut: "24/06/25", dateFin: "28/06/25", label: "non labellisé", representations: 6, spectateurs: 769, jauge: 130, frequentation: 98.50, coords: [48.8566, 2.3522] },
            { spectacle: "Éducations Sentimentales", lieu: "Théâtre de Saint-Quentin-en-Yvelines", ville: "Saint-Quentin-en-Yvelines", pays: "France", region: "Île-de-France", dateDebut: "06/02/25", dateFin: "08/02/25", label: "Scène nationale", representations: 3, spectateurs: 584, jauge: 230, frequentation: 84.64, coords: [48.7710, 2.0180] },
            { spectacle: "Éducations Sentimentales", lieu: "Le Quartz", ville: "Brest", pays: "France", region: "Bretagne", dateDebut: "13/05/25", dateFin: "16/05/25", label: "Scène nationale", representations: 3, spectateurs: 143, jauge: 70, frequentation: 86.14, coords: [48.3904, -4.4861] }

        ];

        // Fonction pour définir la couleur du marqueur en fonction du spectacle
        function getMarkerColor(spectacle) {
            switch (spectacle) {
                case "Éducations Sentimentales":
                    return "#00a933"; // Vert
                case "La Tendresse":
                    return "#9973e1"; // Violet
                case "Désobéir":
                    return "#5b9bd5"; // Bleu
                default:
                    return "#000000"; // Noir par défaut
            }
        }
        
        let markerBounds = L.latLngBounds([]);
        let totalSpectateurs = 0;
        let frequentations = [];
        
        tournees.forEach(tournee => {
            // Calcul des statistiques
            totalSpectateurs += tournee.spectateurs;
            if (tournee.frequentation) {
                frequentations.push(tournee.frequentation);
            }
            
            // Contenu du popup avec la fréquentation ajoutée
            const popupContent = `
                <div class="popup-content">
                    <strong>Spectacle:</strong> ${tournee.spectacle}<br>
                    <strong>Lieu:</strong> ${tournee.lieu}<br>
                    <strong>Ville:</strong> ${tournee.ville}<br>
                    <strong>Pays:</strong> ${tournee.pays}<br>
                    <strong>Région:</strong> ${tournee.region}<br>
                    <strong>Dates:</strong> ${tournee.dateDebut} - ${tournee.dateFin}<br>
                    <strong>Représentations:</strong> ${tournee.representations}<br>
                    <strong>Spectateurs:</strong> ${tournee.spectateurs}<br>
                    ${tournee.jauge ? `<strong>Jauge:</strong> ${tournee.jauge}<br>` : ''}
                    ${tournee.frequentation ? `<strong>Frequentation:</strong> ${tournee.frequentation.toFixed(2)}%<br>` : ''}
                    <strong>Label:</strong> ${tournee.label}
                </div>
            `;
            
            markerBounds.extend(tournee.coords);
            
            // Créer un marqueur avec la couleur spécifique
            L.marker(tournee.coords, {
                icon: L.divIcon({
                    className: 'custom-icon',
                    html: `<div style="width: 10px; height: 10px; background-color: ${getMarkerColor(tournee.spectacle)}; border-radius: 50%;"></div>`
                })
            })
            .addTo(map)
            .bindPopup(popupContent);
        });
        
        // Calcul de la moyenne de fréquentation
        const moyenneFrequentation = frequentations.length > 0 
            ? frequentations.reduce((a, b) => a + b, 0) / frequentations.length
            : 0;
        
        // Mise à jour des statistiques
        document.getElementById('total-spectateurs').textContent = `Total spectateurs: ${totalSpectateurs}`;
        document.getElementById('moyenne-frequentation').textContent = `Fréquentation moyenne: ${moyenneFrequentation.toFixed(2)}%`;
        
        map.fitBounds(markerBounds, {
            padding: [30, 30],
            maxZoom: 12
        });
        
        // Ajout du bouton de réinitialisation
        L.Control.ResetView = L.Control.extend({
            onAdd: function(map) {
                const container = L.DomUtil.create('div', 'leaflet-bar leaflet-control');
                const button = L.DomUtil.create('a', 'reset-view-button', container);
                button.href = '#';
                button.title = 'Réinitialiser la vue';
                button.innerHTML = '⟳';
                
                L.DomEvent.on(button, 'click', function(e) {
                    e.preventDefault();
                    map.fitBounds(markerBounds, {
                        padding: [30, 30],
                        maxZoom: 12
                    });
                });
                
                return container;
            }
        });
        
        L.control.resetView = function(opts) {
            return new L.Control.ResetView(opts);
        };
        
        L.control.resetView({ position: 'topleft' }).addTo(map);
    </script>
</body>
</html>
